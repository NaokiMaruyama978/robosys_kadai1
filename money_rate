#!/usr/bin/python3
# SPDX-FileCopyrightText: 2024 Naoki Maruyama
# SPDX-License-Identifier: BSD-3-Clause

import yfinance as yf
import datetime
import sys

def get_fx_rate(ticker):
    # money_rate_test.bashからレートを取得
    import os
    test_rate = os.getenv(f"TEST_RATE_{ticker}")
    if test_rate:
        return float(test_rate)

    # 通常の為替レート取得
    return yf.Ticker(ticker).history(period="1d").Close[0]

def main(value):
    
    fx_rate = 1.2355 #get_fx_rate("JPYUSD=X") #ドル
    fx_rate2 = 0.5632 #get_fx_rate("JPYEUR=X") #ユーロ
    fx_rate3 = 13.542 #get_fx_rate("JPYKRW=X") #ウォン

    now = datetime.datetime.now() # 現在時刻の取得
    today = now.strftime('%Y年%m月%d日%H時%M分') # 現在時刻を年・月・日・時間・分で表示
    #date = datetime.datetime.now()

    doll = round(value * fx_rate,2) #小数点第3位以下を丸める
    intdoll = int(doll) #結果の整数部分を抜き出す
    dollcent = round((((value * fx_rate) - intdoll) * 100)) #結果から整数値を引き100掛ける事でセントに変換
    
    eur = round(value * fx_rate2,2) #小数点第3位以下を丸める
    inteur = int(eur) #結果の整数部分を抜き出す
    eurcent =  round((((value * fx_rate2) - inteur) * 100))#結果から整数値を引き100掛ける事でセントに変換
    
    won = round(value * fx_rate3,2) #小数点第3位以下を丸める
    intwon = int(won) #結果の整数部分を抜き出す
    wonjeon = round((((value * fx_rate3) - intwon) * 100))#結果から整数値を引き100掛ける事でjeon(チョン)に変換
    # 結果を表示
    print ("{}のレートを参照しています".format(str(today)))
    print ("{}ドル {}セント".format(intdoll,dollcent))
    print ("{}ユーロ {}セント".format(inteur,eurcent))
    print ("{}ウォン {}チョン".format(intwon,wonjeon))
    print ("{}, {},{}".format(fx_rate,fx_rate2,fx_rate3))

if not sys.stdin.isatty():
    value = float(sys.stdin.readline().strip())
    main(value)

elif len(sys.argv) > 1 :
    value = float(sys.argv[1])
    main(value)
